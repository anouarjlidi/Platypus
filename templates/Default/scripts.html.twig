<!-- core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
{%  trans_default_domain 'System' %}

<script src="{{ asset('js/jquery.min.js') }}"></script>
<script src="{{ asset('js/jquery-ui.min.js') }}"></script>

{% include '@' ~ templateName ~ '/script.html.twig' %}
{% include '@HillrangeForm/script.html.twig' %}


{% if app is defined %}
    {% if app.user is defined %}
        {% include '@HillrangeSecurity/security/scripts.html.twig' %}
        <script src={{ asset('bundles/hillrangeform/js/bootstrap-submenu.min.js') }}></script>
    <script type="text/javascript" charset="utf-8">
        function menuSectionSlide() {
            var scroll_top = $(window).scrollTop();
            var menuHeight = $('#sectionMenuContainer').outerHeight();
            var contentHeight = $('#contentContainer').outerHeight();
            if (menuHeight > (contentHeight - 50)) {
                return ;
            }
            var windowHeight = $(window).height();
            if (windowHeight < menuHeight) {
                $('#sectionMenuContainer').css("overflow-y", "scroll");
                return ;
            }
            if (scroll_top >= 247) { // the detection!
                $('#sectionMenuContainer').addClass('is-sticky');
            } else {
                $('#sectionMenuContainer').removeClass('is-sticky');
            }
        }
        $(window).scroll(menuSectionSlide);
    </script>
    {% endif %}
{% endif %}
<!-- fold Menu -->
<script type="text/javascript" charset="utf-8">
    $(".alert").alert();
    $('.foldMenu').on('click', function(){
        var foldMenu = $('.foldMenu');
        var container = $('#contentContainer');
        console.log(container);
        var icon = foldMenu.children('svg');
        if (icon.hasClass('fa-times-circle')) {
            $.ajax({
                url: '{{ path('section_menu_display', {display: 'hide'}) }}',
                type: 'POST'
            });
            container.css('flex', 'auto');
            container.css('max-width', 'none');
        } else {
            $.ajax({
                url: '{{ path('section_menu_display', {display: 'show'}) }}',
                type: 'POST'
            });
            container.removeAttr('style');
        }
        icon.toggleClass('fa-times-circle fa-bars');
        if (icon.attr('data-prefix') == 'far') {
            icon.attr('data-prefix', 'fas');
        } else {
            icon.attr('data-prefix', 'far');
        }
    });

    function iconDoneRendering () {
        {% if not app.session.has('showSectionMenu') %}
            {% set x = app.session.set('showSectionMenu', 'show') %}
        {% endif %}
        var show = '{{ app.session.get('showSectionMenu')|default('show') }}';

        {% if fullpage is defined %}
            {% if (fullpage) %}
                {{ 'show = "hide";' }}
            {% else %}
                {{ 'show = "show";' }}
            {% endif %}
        {% endif %}

        if (show == 'hide') {
            $('.foldMenu').click();
        }
    }

    {% set interval = 120000 %}
    {% if getUserManager().isStaff %}
        {% set interval = 10000 %}
    {% endif %}

    $(document).ready(function(){
        setInterval(function() {
            $.ajax({
                url:'{{ path('notification_manage') }}',
                type: "POST",
                dataType: "json",
                async: true,
                success: function (data)
                {
                    console.log(data)
                    $('div#notifications').html(data.content);

                }
            });
        }, '{{ interval }}');
    });

FontAwesome.dom.i2svg({ callback: iconDoneRendering })
</script>
{% for xx in getScripts() %}
    {% for yy in getScriptOptions(xx) %}
        {% include xx with yy %}
    {% endfor %}
{% endfor %}
<!-- core JavaScript end -->